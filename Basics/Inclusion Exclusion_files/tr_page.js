!function(t,e,n){"use strict";var r=function(){},i={slice:function(t,e,n){return Array.prototype.slice.call(t,e,n)},isFunc:function(t){return"function"==typeof t},hasText:function(t){return/[a-zA-Z\xC0-\uFFFF]/.test(t)},isFrame:function(t){return t&&this.frameTags[t.nodeName]},RTLLangs:{ar:!0,he:!0,fa:!0,ur:!0,yi:!0},debounce:function(e,n){var r;return n=n||100,function(){var i=this,s=arguments;return t.clearTimeout(r),r=t.setTimeout(function(){e.apply(i,s)},n),this}},inherits:function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t},getStyle:function(e){return t.getComputedStyle(e,null)||e.style},isInline:function(t){var e=this.getStyle(t);return"inline"===e.display&&"static"===e.position},frameTags:{FRAME:!0,IFRAME:!0},escapeHTML:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},sendRequest:function(e){var n,i,s,o,a,h,u;return e=e||{},i=e.url||"/",s=e.body||null,a=e.params||"",o=e.method||"GET",h=e.timeout||5e3,u=e.callback||r,n=new t.XMLHttpRequest,n.onload=function(){u(null,this.responseText)},n.onerror=n.ontimeout=function(t){u(new Error(t.type))},a&&(i+=(~i.indexOf("?")?"&":"?")+this.toQueryString(a)),n.open(o,i),n.timeout=h,s&&(s=this.toQueryString(s),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),n.send(s),n},getDirection:function(t){return this.RTLLangs[t]?"rtl":"ltr"},unescapeHTML:function(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")},isButtonInput:function(t){return t&&"INPUT"===t.nodeName&&this.buttonInputTypes[t.type]},toQueryString:function(e){var n,r,i,s,o=[];if(!e)return"";for(i in e)for(s=e[i],Array.isArray(s)||(s=[s]),i=t.encodeURIComponent(i),n=0,r=s.length;r>n;n++)o.push(null==s[n]?i:i+"="+t.encodeURIComponent(s[n]));return o.join("&")},getBrowserLang:function(){var e=t.navigator.language||t.navigator.userLanguage;return e.slice(0,2)},normalizeValue:function(t){return t.replace(/[^\S\n]+/g," ")},buttonInputTypes:{reset:!0,submit:!0,button:!0},sendScriptRequest:function(t){var e;return t=t||{},e=new p(t.url,t),e.send(t.params,t.callback)}},s=function(){this._handlers={}};s.prototype.on=function(t,e){var n=this._handlers;return t&&i.isFunc(e)?((n[t]=n[t]||[]).push(e),this):this},s.prototype.off=function(t,e){var n,r,i=this._handlers[t];if(!i)return arguments.length||(this._handlers={}),this;if(1===arguments.length)return delete this._handlers[t],this;for(n=0,r=i.length;r>n;n++)if(i[n]===e){i.splice(n,1);break}return this},s.prototype.emit=function(t){var e,n,r=i.slice(arguments,1),s=this._handlers[t];if(s)for(s=i.slice(s),e=0,n=s.length;n>e;e++)s[e].apply(this,r);return this};var o=function(){this.setParams({})};o.prototype.getParam=function(t){return this._params[t]},o.prototype.setParam=function(t,e){this._params[t]=e},o.prototype.setParams=function(t){this._params=t||{}};var a=function(t,e){o.call(this),this._node=t,e&&this.setParams(e)};i.inherits(a,o),a.prototype.getNode=function(){return this._node},a.prototype.getValue=function(){return this._node.parentNode?this._node.nodeValue:""},a.prototype.setValue=function(t){this._node.parentNode&&(this._node.nodeValue=t)};var h=function(){a.apply(this,arguments)};i.inherits(h,a),h.prototype.getValue=function(){return this._node.getAttribute(this.getParam("attr"))},h.prototype.setValue=function(t){this._node.setAttribute(this.getParam("attr"),t)};var u=function d(t,e,n){o.call(this),this._type=t||d.TYPE_TEXT,this._spans=e||[],n&&this.setParams(n)};i.inherits(u,o),u.TYPE_ATTR="attr",u.TYPE_TEXT="text",u.prototype.getType=function(){return this._type},u.prototype.setType=function(t){this._type=t},u.prototype.addSpan=function(t){this._spans.push(t)},u.prototype.getSpan=function(t){return this._spans[t]},u.prototype.setSpan=function(t,e){this._spans[t]=e},u.prototype.getSpans=function(){return this._spans.slice()},u.prototype.getValue=function(t){var e,n,r=[],i=this.getSpans();for(e=0,n=i.length;n>e;e++)r.push(i[e].getValue());return t?r.join(""):r},u.prototype.setValue=function(t){var e,n,r=this.getSpans();for(e=0,n=r.length;n>e;e++)r[e].setValue(t[e])},u.prototype.getLength=function(){return this._spans.length};var l=function(t){t=t||{},o.call(this),this._filters=t.filters||[],this._element=t.element||e.documentElement,this._highAccuracy=!!t.highAccuracy,this._maxChunkLength=t.maxChunkLength||1e4,this.update()};i.inherits(l,o),l.ATTRS={alt:!0,abbr:!0,title:!0,label:!0,value:function(t){return i.isButtonInput(t)},content:function(t){return"META"===t.nodeName&&(t.name.indexOf("title")>=0||t.name.indexOf("description")>=0)},placeholder:!0,"aria-label":!0},l.INLINE_TAGS={A:!0,B:!0,I:!0,Q:!0,S:!0,U:!0,BR:!0,EM:!0,RP:!0,RT:!0,TT:!0,BDI:!0,BDO:!0,BIG:!0,DEL:!0,DFN:!0,IMG:!0,INS:!0,KBD:!0,MAP:!0,SUB:!0,SUP:!0,VAR:!0,WBR:!0,ABBR:!0,CITE:!0,CODE:!0,DATA:!0,MARK:!0,RUBY:!0,SAMP:!0,SPAN:!0,TIME:!0,INPUT:!0,LABEL:!0,METER:!0,SMALL:!0,BUTTON:!0,OBJECT:!0,SCRIPT:!0,SELECT:!0,STRONG:!0,ACRONYM:!0,TEXTAREA:!0},l.SERVICE_TAGS={BASE:!0,LINK:!0,META:!0,STYLE:!0,SCRIPT:!0,NOSCRIPT:!0},l.INVALID_TAGS={SVG:!0,MATH:!0,RUBY:!0,AUDIO:!0,EMBED:!0,VIDEO:!0,CANVAS:!0,OBJECT:!0,PROGRESS:!0,TEXTAREA:!0},l.NOT_TRANSLATABLE_TAGS={KBD:!0,VAR:!0,CODE:!0,SAMP:!0,ADDRESS:!0},l.prototype.reset=function(){this._chunks=[],this._currentChunk=new u,this._processedElements=[]},l.prototype.update=function(){var t,e,n=this._filters;for(this.reset(),this._parseNode(this._element),t=0,e=n.length;e>t;t++)n[t](this._chunks)},l.prototype.getDir=function(){var t=this._element;return t.dir||i.getStyle(t).direction},l.prototype.getLang=function(){return this._element.lang.slice(0,2)},l.prototype.setLang=function(e,n){var r,s,o,a,h=i.getDirection(e),u="ltr"===h?"left":"right",p=this._processedElements;for(r=0,s=p.length;s>r;r++)a=p[r],a.lang&&a.lang!==e&&(a.lang=e),n&&!l.SERVICE_TAGS[a.nodeName]&&!function(e){t.setTimeout(function(){o=i.getStyle(e),o.direction!==h&&(e.style.direction=h),o.textAlign!==u&&"center"!==o.textAlign&&(e.style.textAlign=u)},0)}(a);return this},l.prototype.addChunk=function(t){this._chunks.push(t)},l.prototype.getChunk=function(t){return this._chunks[t]},l.prototype.getValue=function(t){var e,n,r=[],i=this.getChunks();for(e=0,n=i.length;n>e;e++)r.push(i[e].getValue(t));return t?r.join(""):r},l.prototype.getChunks=function(){return this._chunks.slice()},l.prototype.getLength=function(){return this._chunks.length},l.prototype.getElement=function(){return this._element},l.prototype.toValueMap=function(){var t,e,n,r,i,s,o={},a=this.getChunks();for(t=0,n=a.length;n>t;t++)for(s=a[t].getSpans(),e=0,r=s.length;r>e;e++)i=s[e].getValue(),(o[i]=o[i]||[]).push(s[e]);return o},l.prototype._parseNode=function(t,e){var n,r,s,o,h,u=this._currentChunk;if(t)switch(t.nodeType){case Node.TEXT_NODE:if(r=t.nodeValue,e||!r.trim())return;if(u.getValue(!0).length+r.length>this._maxChunkLength&&(u=this._flushChunk(),r.length>this._maxChunkLength)){if(s=r.slice(0,this._maxChunkLength).search(/\s\S*$/),0>s)return;t.splitText(s),r=t.nodeValue}return void u.addSpan(new a(t,{value:r}));case Node.ELEMENT_NODE:if(h=t.getAttribute("translate"),""===h&&(h="yes"),e=l.NOT_TRANSLATABLE_TAGS[t.nodeName]||"no"===h||!!e&&"yes"!==h,e||(this._extractAttrs(t),this._processedElements.push(t)),!l.SERVICE_TAGS[t.nodeName]&&!l.INVALID_TAGS[t.nodeName]){if(i.isFrame(t))return this._parseFrame(t,e);for(t.shadowRoot&&this._parseNode(t.shadowRoot,e),o=this._highAccuracy?i.isInline(t):l.INLINE_TAGS[t.nodeName],o||this._flushChunk(),n=t.firstChild;n;n=n.nextSibling)this._parseNode(n,e);o||this._flushChunk()}return;case Node.DOCUMENT_FRAGMENT_NODE:for(n=t.firstChild;n;n=n.nextSibling)this._parseNode(n,e);return}},l.prototype._parseFrame=function(t,e){var n=t.getAttribute("src");if((!n||/\s*about:blank\s*/i.test(n))&&t.contentDocument)try{this._parseNode(t.contentDocument.body,e)}catch(r){}},l.prototype._flushChunk=function(){var t=this._currentChunk;return t.getLength()>0&&(i.hasText(t.getValue(!0))&&this.addChunk(t),this._currentChunk=new u),this._currentChunk},l.prototype._extractAttrs=function(t){var e,n,r;for(e in l.ATTRS)if(n=t.getAttribute(e),r=l.ATTRS[e],n&&n.length<=this._maxChunkLength&&i.hasText(n)){if(i.isFunc(r)&&!r(t))continue;this.addChunk(new u(u.TYPE_ATTR,[new h(t,{attr:e,value:n})]))}return this};var p=function(t,e){e=e||{},this._src=t,this._timeout=e.timeout||5e3,this._callbackName=e.callbackName||"callback"};p.counter=0,p.generateId=function(){return"_"+(this.counter++).toString(36)},p.storage="_"+(+new Date).toString(36)+"_",p.prototype.send=function(n,s){var o=this._id=p.generateId(),a=this._src,h=this,u=this._script=e.createElement("script"),l=e.getElementsByTagName("script")[0];return n=n||{},n[this._callbackName]=[p.storage,o].join("."),s=s||r,t[p.storage]=t[p.storage]||{},u.src=a+(a.indexOf("?")<0?"?":"&")+i.toQueryString(n),u.onerror=function(){h._cleanup(),s(new Error)},t[p.storage][o]=function(t){h._cleanup(!0),s(null,t)},this._timer=t.setTimeout(u.onerror,this._timeout),l.parentNode.insertBefore(u,l),this},p.prototype.abort=function(){return this._cleanup(!1)},p.prototype._cleanup=function(e){var n=this._id,i=this._script;return i?(t.clearTimeout(this._timer),e?delete t[p.storage][n]:t[p.storage][n]=r,i.onerror=null,i.parentNode&&i.parentNode.removeChild(i),this._script=null,this):this};var c=function(t){t=t||{},this._key=t.key,this._srv=t.srv,this._sid=t.sid,this._url=t.url||"/",this._timeout=t.timeout,this._requests={},this._requestCounter=0,this.setFormat(t.format)};c.MAX_TEXT_LENGTH=1e4,c.prototype.abort=function(){var t,e=this._requests;for(t in e)e[t].abort();return this._requests={},this},c.prototype.setFormat=function(t){return this._format=t||"text",this},c.prototype.translate=function(t,e,n){var r,s=this._requests;return!t||t.join("").length>c.MAX_TEXT_LENGTH?n(new Error("Invalid text!")):(r="_"+ ++this._requestCounter,s[r]=i.sendScriptRequest({url:this._url,params:{id:this._sid+"-"+this._requestCounter,key:this._key,srv:this._srv,text:t,lang:e,format:this._format},timeout:this._timeout,callback:function(t,e){delete s[r],e&&200!==e.code&&(t=new Error(e.message),e=null),n(t,e)}}),this)};var g=function(e){var n=this;s.call(this),this._options={subtree:!0,childList:!0,characterData:!0},this._element=e,this._observer=new t.MutationObserver(i.debounce(function(t){n.emit("modify",t)}))};i.inherits(g,s),g.canUse=function(){return"MutationObserver"in t},g.prototype.observe=function(){return this._observer.observe(this._element,this._options),this},g.prototype.hibernate=function(){return this._observer.disconnect(),this};var _=function(t,e){s.call(this),this._element=t,this._timeout=e||5e3,this._interval=0};i.inherits(_,s),_.prototype.observe=function(){var e=this;return this._interval?this:(this._content=this._element.textContent,this._interval=t.setInterval(function(){var t=e._element.textContent;e._content!==t&&(e._content=t,e.emit("modify"))},this._timeout),this)},_.prototype.hibernate=function(){return t.clearInterval(this._interval),this._interval=0,this};var f=function(t){var e,n=this;s.call(this),t=t||{},t.format="html",t.maxChunkLength=this._maxPortionLength=t.maxPortionLength||1e3,this._pageModel=new l(t),this._textTranslator=new c(t),this._maxPortionErrors=t.maxPortionErrors||2,this._maxThreads=t.maxThreads||5,this._maxPortionItems=t.maxPortionItems||20,t.autoSync&&(e=this._pageModel.getElement(),this._observer=g.canUse()?new g(e):new _(e,t.autoSyncInterval),this._observer.on("modify",function(){n.sync()}))};i.inherits(f,s),f.DELIMITER="<wbr>",f.prepareValue=function(t){var e,n;for(e=0,n=t.length;n>e;e++)t[e]=i.escapeHTML(i.normalizeValue(t[e]));return t.join(this.DELIMITER)},f.parseTranslation=function(t){var e,n;for(t=t.split(this.DELIMITER),e=0,n=t.length;n>e;e++)t[e]=i.unescapeHTML(t[e]);return t},f.prototype.halt=function(){return this.abort(),this._observer&&this._observer.hibernate(),this},f.prototype.sync=function(){var t,e,n,r,i,s,o,a,h,u,l,p,c,g,_,f=this._pageModel,d=f.toValueMap(),m=0;for(this.halt(),f.update(),u=f.getChunks(),t=0,r=u.length;r>t;t++){for(_=0,h=u[t],a=h.getSpans(),e=0,i=a.length;i>e;e++)if(o=a[e],p=o.getNode(),c=o.getValue(),g=d[c])for(n=0,s=g.length;s>n;n++)if(l=g[n],p===l.getNode()&&c===l.getParam("translation")){h.setSpan(e,l),_+=1;break}_===i&&(m+=1,h.setParam("translated",!0))}return r>m?this.translate(this._sourceLang,this._targetLang):this._observer&&this._observer.observe(),this},f.prototype.undo=function(){var t,e,n,r,s,o,a,h,u=this._pageModel;for(this.halt(),h=u.getChunks(),t=0,n=h.length;n>t;t++)for(a=h[t],a.setParam("translated",!1),o=a.getSpans(),e=0,r=o.length;r>e;e++)s=o[e],s.setValue(s.getParam("value"));return this._sourceLang&&u.setLang(this._sourceLang,i.getDirection(this._sourceLang)!==i.getDirection(this._targetLang)),this},f.prototype.redo=function(){var t,e,n,r,s,o,a,h,u=this._pageModel;for(this.halt(),a=u.getChunks(),t=0,n=a.length;n>t;t++)for(o=a[t].getSpans(),e=0,r=o.length;r>e;e++)s=o[e],h=s.getParam("translation"),s.getValue()===s.getParam("value")&&h&&(s.setValue(h),s.setParam("translated",!0));return this._targetLang&&u.setLang(this._targetLang,i.getDirection(this._sourceLang)!==i.getDirection(this._targetLang)),this.sync()},f.prototype.abort=function(){return this._textTranslator.abort(),this.emit("abort")},f.prototype.translate=function(e,n){var r,s=this,o=this._pageModel,a=function(){s._translateNext()};if(e=e||"",n=n||i.getBrowserLang(),e===n)return this.emit("complete");for(this._index=0,this._length=o.getLength(),this._progress=0,this._direction=(e&&e+"-")+n,this._readyThreads=0,this._errorCounter={},this.on("abort",this._handleEnd).on("complete",this._handleEnd).on("portionError",this._handleError).on("portionProgress",this._handleProgress),this._sourceLang=e,this._targetLang=n,o.setLang(n,o.getDir()!==i.getDirection(n)),this.emit("progress",0),r=0;r<this._maxThreads;r++)t.setTimeout(a,0);return this},f.prototype._handleEnd=function(){this.off("abort",this._handleEnd).off("complete",this._handleEnd).off("portionError",this._handleError).off("portionProgress",this._handleProgress)},f.prototype._handleError=function(t){var e="_"+t.join(";");this._errorCounter[e]=(this._errorCounter[e]||0)+1,this._errorCounter[e]<=this._maxPortionErrors?this._translatePortion(t):this.emit("error",t).emit("portionProgress",t)},f.prototype._handleProgress=function(t){this._progress+=t.length,this.emit("progress",Math.round(100/this._length*this._progress)),this._translateNext()},f.prototype._getNextPortion=function(){var t,e,n,r=this._pageModel.getChunks(),i=[],s=0,o=0;for(t=this._index,e=r.length;e>t&&s<this._maxPortionItems;t++)if(n=r[t],n.getParam("translated"))this._progress+=1;else{if(o+=n.getValue(!0).length,o>this._maxPortionLength&&s)break;s=i.push(t)}return this._index=t,i},f.prototype._translateNext=function(){var t=this._getNextPortion();return t.length?(this._translatePortion(t),this):(++this._readyThreads===this._maxThreads&&(this._observer&&this._observer.observe(),this.emit("complete")),this)},f.prototype._translatePortion=function(t){var e,n,r,i,s,o,a,h,u=this,l=[];for(e=0,r=t.length;r>e;e++)if(o=t[e],a=this._pageModel.getChunk(o)){for(h=[],s=a.getSpans(),n=0,i=s.length;i>n;n++)h[n]=s[n].getParam("value");l.push(f.prepareValue(h))}return l.length?(this._textTranslator.translate(l,this._direction,function(e,n){return e?u.emit("portionError",t):(u._setTranslation(t,n.text),void u.emit("portionProgress",t))}),this):this.emit("portionProgress",t)},f.prototype._setTranslation=function(t,e){var n,r,i,s,o,a,h,u,l;for(n=0,i=t.length;i>n;n++)if(h=t[n],u=this._pageModel.getChunk(h))for(a=u.getSpans(),u.setParam("translated",!0),l=f.parseTranslation(e[n]),r=0,s=a.length;s>r;r++)o=a[r],o.setValue(l[r]),o.setParam("translation",l[r]);return this},n.PageTranslator=f}(this,this.document,this.yt=this.yt||{});